# 城市拼车预约式车辆路径优化调度器（动态 + 静态）

##  问题背景

本项目针对**城市拼车预约式车辆路径问题（DVRP）**，提出并实现了多个调度算法，目标是在满足乘客时窗与绕路容忍约束的前提下，**完成多车拼车服务调度**，并在此问题下比较多种优化算法的性能。

---

## 问题分类

项目分为两类问题场景：

| 类别       | 描述                                                                 |
|------------|--------------------------------------------------------------------- |
| 动态调度    | 订单逐步到达，系统按滚动时钟持续插入新订单并重优化当前调度路径              |
| 静态调度    | 在某个时间窗内所有订单一次性已知，系统在起始时刻进行改时间窗下的全局调度规划  |

---


## 优化目标

目标：**最小化系统总成本**，兼顾乘客满意度与调度可行性。
目标函数由三部分组成：

总行驶成本：
c 表示单位距离的行驶成本（代码中为 COST_PER_KM）；

固定成本：
Cf 表示每辆车一旦启用即产生的固定成本（代码中为 FIXED_COST）；

总惩罚成本：
包括等候时长惩罚和行程超时惩罚。

---

## 约束条件

调度方案满足以下约束：

1. **容量约束**：每辆车同时最多搭载 `MAX_CAPACITY` 名乘客；
2. **时窗约束**：
   - 上车时间不得晚于乘客的 `late_accept`；
   - 优先满足其 `preferred_start ~ preferred_end` 范围；
3. **行程顺序约束**：每位乘客必须先上车再下车；
4. **行程时长约束**：乘车时间不得超过 `min_travel_time × δ`；
5. **路径可行性**：所有插入的路径必须满足上面所有约束。

---

## 支持算法
### 动态调度算法
| 文件名             | 算法名称     | 简介描述                  |
| --------------- | -------- | --------------------- |
| `A_.py`         | A\* 算法   | 带启发式的实时路径选择，适用于逐步订单接入 |
| `Dijkstra.py`   | Dijkstra | 最短路径启发下的逐步调度优化        |
| `dynamic_GA.py` | 遗传算法 GA  | 支持滚动时间窗下的个体演化与路径再优化   |
### 静态调度算法
| 文件名      | 算法名称   | 简介描述                  |
| -------- | ------ | --------------------- |
| `ACO.py` | 蚁群算法   | 模拟信息素更新与路径选择行为的群体智能算法 |
| `GA.py`  | 遗传算法   | 经典基因交叉与变异用于全局路径组合搜索   |
| `PSO.py` | 粒子群优化  | 模拟粒子速度与位置迭代更新，寻优能力强   |
| `SA.py`  | 模拟退火算法 | 通过扰动与温度控制接受劣解，跳出局部最优  |

---

## 文件目录说明
```plaintext
.
├── dongtai/                      # 动态订单调度
│   ├── data/                     # 含车辆/乘客请求数据
│   ├── results/                  # 动态算法输出目录
│   ├── A_.py                     # 动态 A* 算法主程序
│   ├── Dijkstra.py              # 动态 Dijkstra 算法主程序
│   └── dynamic_GA.py            # 动态遗传算法主程序
│
├── jingtai/                      # 静态订单调度
│   ├── data/                     # 同样格式的乘客+车辆数据
│   ├── results/                  # 静态算法输出目录
│   ├── ACO.py                    # 蚁群算法主程序
│   ├── GA.py                     # 遗传算法主程序
│   ├── PSO.py                    # 粒子群优化算法主程序
│   └── SA.py                     # 模拟退火算法主程序
│
└── README.md                     # 当前说明文档

---

## 评估指标（输出于 summary.txt）

每种算法运行结束后，会生成对应的 `summary.txt` 文件，记录以下关键绩效指标（KPI）：

- `served_passengers`: 成功服务的乘客数  
- `avg_waiting_time`: 平均等待时间（从请求到上车）  
- `avg_travel_time`: 平均乘车时间  
- `total_distance`: 所有车辆行驶总距离  
- `total_cost`: 总运营成本（含惩罚项）  
- `unit_cost`: 单位乘客服务成本  
- `vehicle_utilization`: 车辆使用率（使用车辆数 / 总车辆数）  
- `avg_capacity_util`: 平均容量利用率（加权时间利用）  

---

## 动画输出

为指定的车辆（默认 `[0, 1, 2, 3]`）生成服务路径的 **GIF 动画**，用于展示调度过程，包括：

- 圆点：上车点
- 勾号：下车点
- 路径颜色：统一车辆轨迹
- 数字：当前车上乘客人数
- 图例：颜色对应乘客 ID

动画保存在对应 `results/` 文件夹内，例如：
jingtai/results/genetic_algorithm/vehicle_0.gif



